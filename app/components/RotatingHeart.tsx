'use client';

import { useState, useEffect } from 'react';

// Interpolate between two frames to create a smoother transition
const interpolateFrames = (frame1: string, frame2: string): string => {
  const lines1 = frame1.split('\n');
  const lines2 = frame2.split('\n');
  const result: string[] = [];

  for (let i = 0; i < lines1.length; i++) {
    if (!lines2[i]) continue;
    let newLine = '';
    for (let j = 0; j < lines1[i].length; j++) {
      if (!lines2[i][j]) continue;
      const char1 = lines1[i][j];
      const char2 = lines2[i][j];
      // Choose character based on transition
      if (char1 === char2) {
        newLine += char1;
      } else {
        // Transition between different characters
        const chars = '.- +#@*|';
        const idx1 = chars.indexOf(char1);
        const idx2 = chars.indexOf(char2);
        if (idx1 !== -1 && idx2 !== -1) {
          const midIdx = Math.round((idx1 + idx2) / 2);
          newLine += chars[midIdx] || char1;
        } else {
          newLine += char1;
        }
      }
    }
    result.push(newLine);
  }
  return result.join('\n');
};

// Original frames
const BASE_FRAMES = [
  // Front view (0 deg)
  `
     .-+##+-.   .-+##+-. 
   .+#######+-.+#######+-
  +#####################+ 
 +#######################.
.#########################
.#########################
 +#######################.
  +#####################+ 
   -###################-
     -###############-
       -###########-
         -#######-
           -##-
            -
`,
  // Right rotating (22.5 deg)
  `
     .-+@@+-.   .-+##+-. 
   .+#@@@@##+-.+######+-
  +##@@@@@@@@@########+ 
 +##@@@@@@@@@@@#######.
.###@@@@@@@@@@@########
.###@@@@@@@@@@@########
 +##@@@@@@@@@@@######.
  +##@@@@@@@@@######+ 
   -#@@@@@@@@#####-
     -@@@@@@###-
       -@@@##-
         -#-
          -
`,
  // Right rotating (45 deg)
  `
     .-+||+-.   .-+@+-. 
   .+#||||##+-.+#@@##+-
  +##||||||@@########+ 
 +##|||||||@@@@######.
.###||||||||@@@@######
.###||||||||@@@@######
 +##|||||||@@@@####.
  +##||||||@@####+ 
   -#|||||@@###-
     -|||@@#-
       -|@-
        --
         
`,
  // Right side (67.5 deg)
  `
     .-+||+-.    
   .+#||||##+-. 
  +##||||||@@#+ 
 +###|||||||@@#.
.####||||||||@@#
.####||||||||@@#
 +###|||||||@@#.
  +##||||||@@#+ 
   -#|||||@@#-
     -|||@#-
       -|-
        -
`,
  // Right side (90 deg)
  `
     .-|||-.    
   .+|||||#+-. 
  +|||||||@@#+ 
 +||||||||@@##.
.||||||||||@@##
.||||||||||@@##
 +||||||||@@##.
  +||||||@@##+ 
   -||||@@#-
     -||@-
       -
        
`,
  // Right-back (112.5 deg)
  `
     .-|||-.    
   .+|||||##-. 
  +|||||||###+ 
 +||||||||####.
.||||||||||####
.||||||||||####
 +||||||||####.
  +||||||###+ 
   -||||##-
     -|#-
       -
`,
  // Right-back (135 deg)
  `
     .-++-.    
   .+#####+. 
  +#######*+ 
 +########**.
.#########***
.#########***
 +########**.
  +######*+ 
   -####*-
     -**-
      -
`,
  // Back (157.5 deg)
  `
     .-++-.    
   .+****#+. 
  +*******#+ 
 +********##.
.*********###
.*********###
 +********##.
  +******#+ 
   -****#-
     -**-
      -
`,
  // Back (180 deg)
  `
     .-++-.   .-++-.
   .+****#+-.+****#+.
  +*******#####*****+ 
 +********************
.**********************
.**********************
 +*******************
  +*****************
   -*************-
     -********-
       -***-
        --
`,
  // Left-back (202.5 deg)
  `
     .-++-.   .-|||-.
   .+****#+-.+||||#+.
  +********##||||###+ 
 +**********||||####.
.************|||#####
.************|||#####
 +**********|||####.
  +********||####+ 
   -******|###-
     -***|#-
       -|-
        -
`,
  // Left side (225 deg)
  `
     .-|||-.   .-|||-.
   .+|||||#+-.+||||#+.
  +|||||||############ 
 +||||||||||||||#####.
.||||||||||||||||####
.||||||||||||||||####
 +||||||||||||||###.
  +||||||||||||##+ 
   -||||||||||#-
     -||||||#-
       -||-
        -
`,
  // Left side (247.5 deg)
  `
     .-|||-.   .-+##-.
   .+|||||#+-.+#####+.
  +|||||||############ 
 +||||||||||#########.
.||||||||||||########
.||||||||||||########
 +||||||||||######.
  +||||||||####+ 
   -||||||##-
     -|||#-
       --
        
`,
  // Left rotating (270 deg)
  `
     .-+##-.   .-+##-.
   .+######+-.+#####+.
  +##################+ 
 +###################.
.####################
.####################
 +##################.
  +##############+ 
   -##########-
     -####-
       --
`,
  // Left rotating (292.5 deg)
  `
     .-+##+-.   .-+##-. 
   .+#######+-.+######+-
  +####################+ 
 +#####################.
.#######################
.#######################
 +#####################.
  +###################+ 
   -#################-
     -############-
       -######-
         --
`,
  // Almost front (315 deg)
  `
     .-+##+-.   .-+##+-. 
   .+#######+-.+#######+-
  +#####################+ 
 +#######################.
.#########################
.#########################
 +#######################.
  +#####################+ 
   -###################-
     -###############-
       -###########-
         -#####-
           --
`,
  // Nearly front (337.5 deg)
  `
     .-+##+-.   .-+##+-. 
   .+#######+-.+#######+-
  +#####################+ 
 +#######################.
.#########################
.#########################
 +#######################.
  +#####################+ 
   -###################-
     -###############-
       -###########-
         -#######-
           -##-
            -
`
];

// Generate interpolated frames
const HEART_FRAMES: string[] = [];
for (let i = 0; i < BASE_FRAMES.length; i++) {
  HEART_FRAMES.push(BASE_FRAMES[i]);
  const nextFrame = BASE_FRAMES[(i + 1) % BASE_FRAMES.length];
  HEART_FRAMES.push(interpolateFrames(BASE_FRAMES[i], nextFrame));
}

interface Props {
  isSliding?: boolean;
}

export default function RotatingHeart({ isSliding = false }: Props) {
  const [frameIndex, setFrameIndex] = useState(0);

  useEffect(() => {
    const interval = setInterval(() => {
      setFrameIndex((prev) => (prev + 1) % HEART_FRAMES.length);
    }, 80);

    return () => clearInterval(interval);
  }, []);

  return (
    <div 
      className={`relative font-mono whitespace-pre text-center text-black text-[12px] leading-[1.1] select-none transition-transform duration-500 ${
        isSliding ? '-translate-y-8' : ''
      }`}
    >
      <pre style={{ transform: 'scale(2.5)' }}>
        {HEART_FRAMES[frameIndex]}
      </pre>
    </div>
  );
}
